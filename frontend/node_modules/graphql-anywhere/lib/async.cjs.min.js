"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("apollo-utilities"),r=Object.prototype.hasOwnProperty;function n(e,t){null!==t&&"object"==typeof t&&Object.keys(t).forEach(function(a){var i=t[a];r.call(e,a)?n(e[a],i):e[a]=i})}function a(e,r,n,a,l,o){void 0===o&&(o={});var s=t.getMainDefinition(r),u=t.getFragmentDefinitions(r),c={fragmentMap:t.createFragmentMap(u),contextValue:a,variableValues:l,resultMapper:o.resultMapper,resolver:e,fragmentMatcher:o.fragmentMatcher||function(){return!0}};return i(s.selectionSet,n,c)}function i(r,a,o){return e.__awaiter(this,void 0,void 0,function(){var s,u,c,f,v,m=this;return e.__generator(this,function(p){switch(p.label){case 0:return s=o.fragmentMap,u=o.contextValue,c=o.variableValues,f={},v=function(r){return e.__awaiter(m,void 0,void 0,function(){var v,m,p,d,g;return e.__generator(this,function(e){switch(e.label){case 0:return t.shouldInclude(r,c)?t.isField(r)?[4,l(r,a,o)]:[3,2]:[2];case 1:return v=e.sent(),m=t.resultKeyNameFromField(r),void 0!==v&&(void 0===f[m]?f[m]=v:n(f[m],v)),[2];case 2:if(t.isInlineFragment(r))p=r;else if(!(p=s[r.name.value]))throw new Error("No fragment named "+r.name.value);return d=p.typeCondition.name.value,o.fragmentMatcher(a,d,u)?[4,i(p.selectionSet,a,o)]:[3,4];case 3:g=e.sent(),n(f,g),e.label=4;case 4:return[2]}})})},[4,Promise.all(r.selections.map(v))];case 1:return p.sent(),o.resultMapper?[2,o.resultMapper(f,a)]:[2,f]}})})}function l(r,n,a){return e.__awaiter(this,void 0,void 0,function(){var l,s,u,c,f,v,m;return e.__generator(this,function(e){switch(e.label){case 0:return l=a.variableValues,s=a.contextValue,u=a.resolver,c=r.name.value,f=t.argumentsObjectFromField(r,l),v={isLeaf:!r.selectionSet,resultKey:t.resultKeyNameFromField(r),directives:t.getDirectiveInfoFromField(r,l)},[4,u(c,n,f,s,v)];case 1:return m=e.sent(),r.selectionSet?null==m?[2,m]:Array.isArray(m)?[2,o(r,m,a)]:[2,i(r.selectionSet,m,a)]:[2,m]}})})}function o(e,t,r){return Promise.all(t.map(function(t){return null===t?null:Array.isArray(t)?o(e,t,r):i(e.selectionSet,t,r)}))}exports.graphql=a;
