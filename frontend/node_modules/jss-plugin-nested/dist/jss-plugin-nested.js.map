{"version":3,"file":"jss-plugin-nested.js","sources":["../../../node_modules/@babel/runtime/helpers/esm/extends.js","../../../node_modules/tiny-warning/dist/tiny-warning.esm.js","../src/index.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","var isProduction = process.env.NODE_ENV === 'production';\nfunction warning(condition, message) {\n  if (!isProduction) {\n    if (condition) {\n      return;\n    }\n\n    var text = \"Warning: \" + message;\n\n    if (typeof console !== 'undefined') {\n      console.warn(text);\n    }\n\n    try {\n      throw Error(text);\n    } catch (x) {}\n  }\n}\n\nexport default warning;\n","// @flow\nimport warning from 'tiny-warning'\nimport type {Plugin, StyleRule, StyleSheet} from 'jss'\n\nconst separatorRegExp = /\\s*,\\s*/g\nconst parentRegExp = /&/g\nconst refRegExp = /\\$([\\w-]+)/g\n\n/**\n * Convert nested rules to separate, remove them from original styles.\n *\n * @param {Rule} rule\n * @api public\n */\nexport default function jssNested(): Plugin {\n  // Get a function to be used for $ref replacement.\n  function getReplaceRef(container, sheet?: StyleSheet) {\n    return (match, key) => {\n      let rule = container.getRule(key) || (sheet && sheet.getRule(key))\n      if (rule) {\n        rule = ((rule: any): StyleRule)\n\n        return rule.selector\n      }\n\n      warning(\n        false,\n        `[JSS] Could not find the referenced rule ${key} in ${container.options.meta ||\n          container.toString()}.`\n      )\n      return key\n    }\n  }\n\n  function replaceParentRefs(nestedProp, parentProp) {\n    const parentSelectors = parentProp.split(separatorRegExp)\n    const nestedSelectors = nestedProp.split(separatorRegExp)\n\n    let result = ''\n\n    for (let i = 0; i < parentSelectors.length; i++) {\n      const parent = parentSelectors[i]\n\n      for (let j = 0; j < nestedSelectors.length; j++) {\n        const nested = nestedSelectors[j]\n        if (result) result += ', '\n        // Replace all & by the parent or prefix & with the parent.\n        result +=\n          nested.indexOf('&') !== -1 ? nested.replace(parentRegExp, parent) : `${parent} ${nested}`\n      }\n    }\n\n    return result\n  }\n\n  function getOptions(rule, container, options) {\n    // Options has been already created, now we only increase index.\n    if (options) return {...options, index: options.index + 1}\n\n    let {nestingLevel} = rule.options\n    nestingLevel = nestingLevel === undefined ? 1 : nestingLevel + 1\n\n    return {\n      ...rule.options,\n      nestingLevel,\n      index: container.indexOf(rule) + 1\n    }\n  }\n\n  function onProcessStyle(style, rule, sheet?: StyleSheet) {\n    if (rule.type !== 'style') return style\n\n    const styleRule: StyleRule = (rule: any)\n\n    const container: StyleSheet = (styleRule.options.parent: any)\n    let options\n    let replaceRef\n    for (const prop in style) {\n      const isNested = prop.indexOf('&') !== -1\n      const isNestedConditional = prop[0] === '@'\n\n      if (!isNested && !isNestedConditional) continue\n\n      options = getOptions(styleRule, container, options)\n\n      if (isNested) {\n        let selector = replaceParentRefs(prop, styleRule.selector)\n        // Lazily create the ref replacer function just once for\n        // all nested rules within the sheet.\n        if (!replaceRef) replaceRef = getReplaceRef(container, sheet)\n        // Replace all $refs.\n        selector = selector.replace(refRegExp, replaceRef)\n\n        container.addRule(selector, style[prop], {...options, selector})\n      } else if (isNestedConditional) {\n        // Place conditional right after the parent rule to ensure right ordering.\n        container\n          .addRule(prop, {}, options)\n          // Flow expects more options but they aren't required\n          // And flow doesn't know this will always be a StyleRule which has the addRule method\n          // $FlowFixMe\n          .addRule(styleRule.key, style[prop], {selector: styleRule.selector})\n      }\n\n      delete style[prop]\n    }\n\n    return style\n  }\n\n  return {onProcessStyle}\n}\n"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","warning","condition","message","text","console","warn","Error","x","separatorRegExp","parentRegExp","refRegExp","jssNested","getReplaceRef","container","sheet","match","rule","getRule","selector","options","meta","toString","replaceParentRefs","nestedProp","parentProp","parentSelectors","split","nestedSelectors","result","parent","j","nested","indexOf","replace","getOptions","index","nestingLevel","undefined","onProcessStyle","style","type","styleRule","replaceRef","prop","isNested","isNestedConditional","addRule"],"mappings":"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"}