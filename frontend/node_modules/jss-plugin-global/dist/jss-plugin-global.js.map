{"version":3,"file":"jss-plugin-global.js","sources":["../../../node_modules/@babel/runtime/helpers/esm/extends.js","../src/index.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","// @flow\nimport {\n  RuleList,\n  type Plugin,\n  type RuleOptions,\n  type ContainerRule,\n  type StyleRule,\n  type BaseRule\n} from 'jss'\n\nconst at = '@global'\nconst atPrefix = '@global '\n\nclass GlobalContainerRule implements ContainerRule {\n  type = 'global'\n\n  at: string = at\n\n  rules: RuleList\n\n  options: RuleOptions\n\n  key: string\n\n  isProcessed: boolean = false\n\n  constructor(key, styles, options: RuleOptions) {\n    this.key = key\n    this.options = options\n    this.rules = new RuleList({\n      ...options,\n      parent: this\n    })\n\n    for (const selector in styles) {\n      this.rules.add(selector, styles[selector])\n    }\n\n    this.rules.process()\n  }\n\n  /**\n   * Get a rule.\n   */\n  getRule(name) {\n    return this.rules.get(name)\n  }\n\n  /**\n   * Create and register rule, run plugins.\n   */\n  addRule(name, style, options) {\n    const rule = this.rules.add(name, style, options)\n    this.options.jss.plugins.onProcessRule(rule)\n    return rule\n  }\n\n  /**\n   * Get index of a rule.\n   */\n  indexOf(rule) {\n    return this.rules.indexOf(rule)\n  }\n\n  /**\n   * Generates a CSS string.\n   */\n  toString() {\n    return this.rules.toString()\n  }\n}\n\nclass GlobalPrefixedRule implements BaseRule {\n  type = 'global'\n\n  at: string = at\n\n  name: string\n\n  options: RuleOptions\n\n  rule: BaseRule | null\n\n  isProcessed: boolean = false\n\n  key: string\n\n  constructor(name, style, options) {\n    this.name = name\n    this.options = options\n    const selector = name.substr(atPrefix.length)\n    this.rule = options.jss.createRule(selector, style, {\n      ...options,\n      parent: this\n    })\n  }\n\n  toString(options) {\n    return this.rule ? this.rule.toString(options) : ''\n  }\n}\n\nconst separatorRegExp = /\\s*,\\s*/g\n\nfunction addScope(selector, scope) {\n  const parts = selector.split(separatorRegExp)\n  let scoped = ''\n  for (let i = 0; i < parts.length; i++) {\n    scoped += `${scope} ${parts[i].trim()}`\n    if (parts[i + 1]) scoped += ', '\n  }\n  return scoped\n}\n\nfunction handleNestedGlobalContainerRule(rule) {\n  const {options, style} = rule\n  const rules = style ? style[at] : null\n\n  if (!rules) return\n\n  for (const name in rules) {\n    options.sheet.addRule(name, rules[name], {\n      ...options,\n      selector: addScope(name, rule.selector)\n    })\n  }\n\n  delete style[at]\n}\n\nfunction handlePrefixedGlobalRule(rule) {\n  const {options, style} = rule\n  for (const prop in style) {\n    if (prop[0] !== '@' || prop.substr(0, at.length) !== at) continue\n\n    const selector = addScope(prop.substr(at.length), rule.selector)\n    options.sheet.addRule(selector, style[prop], {\n      ...options,\n      selector\n    })\n    delete style[prop]\n  }\n}\n\n/**\n * Convert nested rules to separate, remove them from original styles.\n *\n * @param {Rule} rule\n * @api public\n */\nexport default function jssGlobal(): Plugin {\n  function onCreateRule(name, styles, options) {\n    if (!name) return null\n\n    if (name === at) {\n      return new GlobalContainerRule(name, styles, options)\n    }\n\n    if (name[0] === '@' && name.substr(0, atPrefix.length) === atPrefix) {\n      return new GlobalPrefixedRule(name, styles, options)\n    }\n\n    const {parent} = options\n\n    if (parent) {\n      if (\n        parent.type === 'global' ||\n        (parent.options.parent && parent.options.parent.type === 'global')\n      ) {\n        options.scoped = false\n      }\n    }\n\n    if (options.scoped === false) {\n      options.selector = name\n    }\n\n    return null\n  }\n\n  function onProcessRule(rule) {\n    if (rule.type !== 'style') return\n\n    handleNestedGlobalContainerRule(((rule: any): StyleRule))\n    handlePrefixedGlobalRule(((rule: any): StyleRule))\n  }\n\n  return {onCreateRule, onProcessRule}\n}\n"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","at","atPrefix","GlobalContainerRule","styles","options","type","rules","isProcessed","RuleList","parent","selector","add","process","getRule","name","get","addRule","style","rule","jss","plugins","onProcessRule","indexOf","toString","GlobalPrefixedRule","substr","createRule","separatorRegExp","addScope","scope","parts","split","scoped","trim","handleNestedGlobalContainerRule","sheet","handlePrefixedGlobalRule","prop","jssGlobal","onCreateRule"],"mappings":"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"}